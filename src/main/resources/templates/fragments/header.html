<!-- å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼ -->
<header th:fragment="header" class="navbar navbar-expand-lg bg-body-tertiary border-bottom">
    <div class="container">
        <a class="navbar-brand fw-bold text-primary" href="/reading-records">
            ğŸ“š Readrico
        </a>

        <div class="d-flex align-items-center">
            <!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
            <button id="darkModeToggle" class="btn btn-outline-secondary btn-sm" type="button"
                    title="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ" aria-label="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ">
                <span id="darkModeIcon">ğŸŒ</span>
            </button>
        </div>
    </div>
</header>

<!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
<script th:fragment="darkModeScript">
    document.addEventListener('DOMContentLoaded', function() {
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeIcon = document.getElementById('darkModeIcon');
        const htmlElement = document.documentElement;

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰è¨­å®šã‚’å–å¾—ã€ãªã‘ã‚Œã°ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚’ä½¿ç”¨
        function getInitialTheme() {
            const savedTheme = localStorage.getItem('readrico-theme');
            if (savedTheme) {
                return savedTheme;
            }
            // ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ç¢ºèª
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        // ãƒ†ãƒ¼ãƒã‚’é©ç”¨
        function applyTheme(theme) {
            if (theme === 'dark') {
                htmlElement.setAttribute('data-bs-theme', 'dark');
                darkModeIcon.textContent = 'ğŸŒ™';
            } else {
                htmlElement.setAttribute('data-bs-theme', 'light');
                darkModeIcon.textContent = 'ğŸŒ';
            }
        }

        // ãƒ†ãƒ¼ãƒã‚’åˆ‡ã‚Šæ›¿ãˆ
        function toggleTheme() {
            const currentTheme = htmlElement.getAttribute('data-bs-theme') || 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            applyTheme(newTheme);
            localStorage.setItem('readrico-theme', newTheme);
        }

        // åˆæœŸãƒ†ãƒ¼ãƒã‚’è¨­å®š
        const initialTheme = getInitialTheme();
        applyTheme(initialTheme);
        localStorage.setItem('readrico-theme', initialTheme);

        // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        darkModeToggle.addEventListener('click', toggleTheme);

        // ã‚·ã‚¹ãƒ†ãƒ ãƒ†ãƒ¼ãƒå¤‰æ›´ã‚’ç›£è¦–
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«è¨­å®šã—ã¦ã„ãªã„å ´åˆã®ã¿ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã«å¾“ã†
            if (!localStorage.getItem('readrico-theme')) {
                applyTheme(e.matches ? 'dark' : 'light');
            }
        });
    });
</script>
